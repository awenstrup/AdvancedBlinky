# Setup

_A guide in how not do do things by Alex_ 

This document will outline how to setup a build environment for embedded development with the STM32 blue pill expansion board. I spent too long setting this up myself, and even now I'm not thrilled with my workflow, but it works.

## Quick start

ST provides an eclipse-based IDE called [STM32CubeIDE](https://www.st.com/en/development-tools/stm32cubeide.html). It is the fastest way to get started writing code for the blue pill, but eclipse can feel a bit heavy and confusing for new users, so I setup my development environment in VSCode. There is also good support developing in CLion, if that's more your style.

## Configuration and Code Generation

Before we start writing code, we can use some of ST's tools to help setup our project. Specifically, we can use [STM32CubeMX](https://www.st.com/en/development-tools/stm32cubemx.html) to setup pins as inputs or outputs, setup timers, communications busses, and other peripherals. By "setup", I really mean that STM32CubeMX will generate starter code that initializes these pins and peripherals for us so that we can start writing functional code with the Hardware Abstraction Layer (HAL) that they provide us. To get started:

* Download and install [STM32CubeMX](https://www.st.com/en/development-tools/stm32cubemx.html)
* Open the app and create a new project
* Setup any pins and peripherals you can think of now, and click "Generate Code" (don't worry, you can change this later without overwriting code you've written)

## Writing code

Now we can start writing code! One way to start programming for an STM32 MCU is by using the provided STM32 HAL, generated specifically for your project by STM32CubeMX. The documentation for the HAL can be found [here](https://www.st.com/resource/en/user_manual/dm00105879-description-of-stm32f4-hal-and-ll-drivers-stmicroelectronics.pdf), and is good, but long (over 2000 pages). I would recommend googling your question first if it's a simple one, then Cmd-F'ing your way through the documentation if google fails you. I've found it can be pretty hard to find a straight answer on google, but if you're willing to comb through a full tutorial for your answer, you can get most basic questions answered. For example, a search for "set pin high stm32 hal" gave me [this](https://simonmartin.ch/resources/stm32/dl/STM32%20Tutorial%2001%20-%20GPIO%20Operations%20using%20HAL%20(and%20FreeRTOS).pdf) for the first result, which answered my question.

## Building

Building code from an STM32CubeMX-generated project tripped me up for a while, and there are a bunch of different ways to do it. STM32CubeIDE makes building easy (there is a built in "Build" button that's configured for you), but you can setup your compiler in a bunch of different ways. First, I tried using PlatformIO, an apparently rather popular framework for embedded development that comes with a very handy VSCode extension. I quickly learned that PlatformIO doesn't seem to play very nicely with projects generated by STM32CubeMX (it might work fine, but I couldn't figure it out). I did manage to get PlatformIO to compile my code nicely, but it felt weird to be using that entire framework in my project when all I needed were it's compiler options. 

I eventually ended up...

## Uploading/flashing

As much as I wanted to upload code to the MCU from the command line, I couldn't figure out a good way to do this. PlatformIO's compiler settings worked great out of the box, but it didn't work as well for uploading. I eventually downloaded ST's tool, 

## Lessons learned



